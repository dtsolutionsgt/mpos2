/*
   martes, 26 de mayo de 202020:26:14
   User: sa
   Server: PROGRAX\SQLEXPRESS
   Database: MPOS2
   Application: 
*/

/* To prevent any potential data loss issues, you should review this script in detail before running it outside the context of the database designer.*/
BEGIN TRANSACTION
SET QUOTED_IDENTIFIER ON
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
COMMIT
BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_PARAMEXT
	DROP CONSTRAINT DF_P_PARAMEXT_Nombre
GO
ALTER TABLE dbo.P_PARAMEXT
	DROP CONSTRAINT DF_P_PARAMEXT_Valor
GO
CREATE TABLE dbo.Tmp_P_PARAMEXT
	(
	CODIGO_PARAMEXT int NOT NULL IDENTITY (1, 1),
	EMPRESA int NULL,
	ID int NULL,
	IDRUTA nvarchar(15) NULL,
	NOMBRE nvarchar(50) NULL,
	VALOR nvarchar(50) NULL
	)  ON [PRIMARY]
GO
ALTER TABLE dbo.Tmp_P_PARAMEXT SET (LOCK_ESCALATION = TABLE)
GO
ALTER TABLE dbo.Tmp_P_PARAMEXT ADD CONSTRAINT
	DF_P_PARAMEXT_Nombre DEFAULT ('') FOR Nombre
GO
ALTER TABLE dbo.Tmp_P_PARAMEXT ADD CONSTRAINT
	DF_P_PARAMEXT_Valor DEFAULT ('') FOR Valor
GO
SET IDENTITY_INSERT dbo.Tmp_P_PARAMEXT OFF
GO
IF EXISTS(SELECT * FROM dbo.P_PARAMEXT)
	 EXEC('INSERT INTO dbo.Tmp_P_PARAMEXT (EMPRESA, ID, IDRUTA, Nombre, Valor)
		SELECT EMPRESA, ID, IDRUTA, Nombre, Valor FROM dbo.P_PARAMEXT WITH (HOLDLOCK TABLOCKX)')
GO
DROP TABLE dbo.P_PARAMEXT
GO
EXECUTE sp_rename N'dbo.Tmp_P_PARAMEXT', N'P_PARAMEXT', 'OBJECT' 
GO
ALTER TABLE dbo.P_PARAMEXT ADD CONSTRAINT
	PK_P_PARAMEXT_1 PRIMARY KEY CLUSTERED 
	(
	CODIGO_PARAMEXT
	) WITH( STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]

GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'CONTROL') as Contr_Per 


/*
   martes, 26 de mayo de 202020:28:26
   User: sa
   Server: PROGRAX\SQLEXPRESS
   Database: MPOS2
   Application: 
*/

/* To prevent any potential data loss issues, you should review this script in detail before running it outside the context of the database designer.*/
BEGIN TRANSACTION
SET QUOTED_IDENTIFIER ON
SET ARITHABORT ON
SET NUMERIC_ROUNDABORT OFF
SET CONCAT_NULL_YIELDS_NULL ON
SET ANSI_NULLS ON
SET ANSI_PADDING ON
SET ANSI_WARNINGS ON
COMMIT
BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_EMPRESA SET (LOCK_ESCALATION = TABLE)
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_EMPRESA', 'Object', 'CONTROL') as Contr_Per BEGIN TRANSACTION
GO
ALTER TABLE dbo.P_PARAMEXT ADD CONSTRAINT
	FK_P_PARAMEXT_P_EMPRESA FOREIGN KEY
	(
	EMPRESA
	) REFERENCES dbo.P_EMPRESA
	(
	EMPRESA
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
	
GO
ALTER TABLE dbo.P_PARAMEXT SET (LOCK_ESCALATION = TABLE)
GO
COMMIT
select Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'ALTER') as ALT_Per, Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'VIEW DEFINITION') as View_def_Per, Has_Perms_By_Name(N'dbo.P_PARAMEXT', 'Object', 'CONTROL') as Contr_Per 
